<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unit 4 – Stumbling upon the Past | Vocabulary Practice</title>
  <style>
    :root{
      --bg1:#071220;
      --bg2:#0b1f33;
      --card:#0f2a42cc;
      --card2:#102f4ccc;
      --stroke:#2b4663;
      --text:#e9f1ff;
      --muted:#b8c7dc;
      --muted2:#8ea6c4;
      --accent:#79a7ff;
      --good:#49d17d;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --btn:#1b3e66;
      --btn2:#245184;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 20px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: "Century Gothic", "Trebuchet MS", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 10% 10%, #153a60 0%, transparent 60%),
        radial-gradient(900px 700px at 90% 15%, #1b2b6a 0%, transparent 55%),
        radial-gradient(900px 700px at 70% 90%, #0b4a64 0%, transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      padding:28px 18px;
    }

    .wrap{
      max-width: 1180px;
      margin:0 auto;
    }

    /* Header */
    .topbar{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 26px;
      padding: 18px 18px;
      display:flex;
      gap:18px;
      align-items:center;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .logoBox{
      width:66px; height:66px;
      border-radius: 18px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logoBox img{
      width:52px; height:52px;
      object-fit: contain;
      display:block;
    }
    .titleBlock{
      flex: 1 1 auto;
      min-width: 220px;
    }
    h1{
      margin:0;
      font-size: 40px;
      letter-spacing: .2px;
      line-height: 1.05;
    }
    .subtitle{
      margin-top:6px;
      color: var(--muted);
      font-size: 16px;
    }
    .pills{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }
    .pill{
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 15px;
      min-width: 150px;
      text-align:center;
      backdrop-filter: blur(8px);
    }
    .pill strong{ color: var(--text); font-weight: 700; }

    /* Layout */
    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 2.2fr 1fr;
      gap: 16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .pills{ justify-content:flex-start; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
    }
    .card h2{
      margin: 0 0 10px 0;
      font-size: 20px;
      color: var(--text);
      letter-spacing:.2px;
    }
    .label{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(121,167,255,.14);
      border: 1px solid rgba(121,167,255,.25);
      color: #dbe8ff;
      font-size: 13px;
      margin-bottom: 10px;
    }

    .promptTitle{
      font-size: 18px;
      margin: 0 0 8px 0;
      color: var(--muted);
    }

    .promptBox{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 14px 14px;
      margin-bottom: 12px;
      white-space: pre-line;
      line-height: 1.5;
      color: var(--text);
    }

    .options{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 640px){
      .options{ grid-template-columns: 1fr; }
    }

    .opt{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 14px 14px;
      font-size: 17px;
      text-align:left;
      cursor:pointer;
      transition: transform .08s, background .12s, border-color .12s;
    }
    .opt:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.22);
    }
    .opt:disabled{
      opacity: .65;
      cursor: default;
      transform:none;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    .btn{
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 15px;
      cursor:pointer;
      background: var(--btn2);
      color: white;
      transition: transform .08s, filter .12s;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .btn.secondary{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }

    .feedback{
      margin-top: 10px;
      min-height: 46px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      color: var(--muted);
      line-height: 1.45;
    }
    .feedback.good{
      border-color: rgba(73,209,125,.35);
      background: rgba(73,209,125,.10);
      color: #d9ffe7;
    }
    .feedback.warn{
      border-color: rgba(255,204,102,.35);
      background: rgba(255,204,102,.10);
      color: #fff1d1;
    }

    .small{
      color: var(--muted2);
      font-size: 13px;
      line-height:1.35;
    }

    /* Right panel */
    .infoBlock{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .mini{
      background: rgba(0,0,0,.14);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 14px;
    }
    .mini h3{
      margin:0 0 8px 0;
      font-size: 16px;
      color: var(--text);
    }
    .kv{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .tag{
      font-size: 13px;
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .list{
      margin: 8px 0 0 0;
      padding-left: 18px;
      color: var(--muted);
      line-height:1.5;
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 10px 0;
    }
    .hidden{
      display:none !important;
    }

    /* Unscramble UI */
    .scrambleRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items:center;
    }
    .input{
      flex: 1 1 220px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px 14px;
      font-size: 16px;
      outline:none;
    }
    .input::placeholder{ color: rgba(233,241,255,.55); }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 15px;
      letter-spacing: .5px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      display:inline-block;
    }

    /* Progress bar */
    .bar{
      height:10px;
      width:100%;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(121,167,255,.85), rgba(73,209,125,.75));
      border-radius: 999px;
      transition: width .18s;
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- TOP -->
  <div class="topbar">
    <div class="logoBox" title="Logo">
      <!-- Put your logo file in the SAME folder as this HTML and name it: logo.png -->
      <img id="logoImg" src="logo.png" alt="Logo" onerror="this.style.display='none';">
    </div>

    <div class="titleBlock">
      <h1>Unit 4 – Stumbling upon the Past</h1>
      <div class="subtitle">Vocabulary Practice · Context first · Spelling (Unscramble) · Reading Comprehension</div>
    </div>

    <div class="pills">
      <div class="pill">Progress: <strong id="pillProgress">1/22</strong></div>
      <div class="pill">Score: <strong id="pillScore">0</strong></div>
      <div class="pill">Mode: <strong id="pillMode">Main</strong></div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid">

    <!-- LEFT: Activity -->
    <div class="card">
      <div class="label" id="sectionLabel">Vocabulary in Context</div>

      <div class="promptTitle" id="qHeader">Question 1 of 22</div>
      <div class="promptBox" id="promptBox">Loading…</div>

      <!-- MCQ options -->
      <div class="options" id="options"></div>

      <!-- Unscramble area -->
      <div id="unscrambleArea" class="hidden">
        <div class="small">Type the word. Spelling matters.</div>
        <div class="scrambleRow">
          <span class="kbd" id="scrambleText">—</span>
          <input class="input" id="spellInput" type="text" placeholder="Type the word here…" autocomplete="off" />
          <button class="btn" id="checkSpellBtn">Check</button>
        </div>
      </div>

      <!-- Reading area (same UI as MCQ, but includes excerpt in promptBox) -->
      <!-- feedback + controls -->
      <div class="feedback" id="feedback">Click an answer. If it’s wrong, read the hint and try again.</div>

      <div class="row">
        <button class="btn secondary" id="restartBtn">Restart</button>
        <button class="btn secondary" id="hintBtn">Hint</button>
        <button class="btn" id="nextBtn" disabled>Next</button>
      </div>

      <div style="margin-top:12px;">
        <div class="small" style="margin-bottom:8px;">Progress bar</div>
        <div class="bar"><div id="barFill"></div></div>
      </div>
    </div>

    <!-- RIGHT: Info -->
    <div class="infoBlock">

      <div class="card">
        <h2>Quick Info</h2>

        <div class="mini">
          <h3>How to play</h3>
          <ul class="list">
            <li>Read the context sentence (or excerpt).</li>
            <li>Choose the best vocabulary word.</li>
            <li>If wrong: read the hint, then try again.</li>
            <li>Spelling section: unscramble and type the word.</li>
            <li>Finish with 2 reading comprehension questions.</li>
          </ul>
        </div>

        <div class="mini" id="vocabPanel">
          <h3>Vocabulary list</h3>
          <div class="kv" id="vocabTags"></div>
          <div class="divider"></div>
          <div class="small">Note: This list hides during spelling tasks (so students cannot copy).</div>
        </div>
      </div>

    </div>

  </div>
</div>

<script>
  /************************************************************
   * CONTENT
   * - Focus on the vocab list in your screenshot (Unit 4)
   * - Add 5 spelling (unscramble) tasks
   * - Add 2 difficult reading comprehension questions with excerpt
   ************************************************************/

  const vocabList = [
    "ash","dinosaur","discover","examine","excavate","layers",
    "paleontologist","pastime","ravine","sedimentary rock","skull",
    "determine","dream","favorite","tripped"
  ];

  // Utility: shuffle array
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  // Build tag list
  const vocabTagsEl = document.getElementById("vocabTags");
  vocabList.forEach(w=>{
    const s = document.createElement("span");
    s.className = "tag";
    s.textContent = w;
    vocabTagsEl.appendChild(s);
  });

  // Question bank (22 total)
  // Rules:
  // - Context-based MCQ (no “meaning first” label shown to students)
  // - Hints do NOT reveal the answer directly
  const questions = [
    // ============ VOCAB IN CONTEXT (15) ============
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nJavier’s favorite __________ was to explore the hills and open fields near his town.",
      options:["pastime","layers","ash","skull"],
      answer:"pastime",
      hint:"This word means an activity someone does for fun in their free time."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nJavier __________ on something in the field and almost fell.",
      options:["tripped","determined","excavated","dreamed"],
      answer:"tripped",
      hint:"Think: his foot caught on something and he lost his balance."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nA __________ is a deep, narrow valley; it can be hard to climb out of.",
      options:["ravine","layers","ash","pastime"],
      answer:"ravine",
      hint:"This is a landform. People can fall into it or walk down into it."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThe scientist came to __________ the strange object and look at it carefully.",
      options:["examine","discover","tripped","layers"],
      answer:"examine",
      hint:"This verb means to look closely to check details."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nJavier was sure the object was special. He didn’t just __________ it—he wanted proof.",
      options:["dream","discover","layers","ash"],
      answer:"dream",
      hint:"This can mean a strong hope or wish about the future."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThe team did not want to guess. They needed to __________ how old the bone was.",
      options:["determine","discover","tripped","favorite"],
      answer:"determine",
      hint:"This means to find out the correct answer using evidence or steps."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nA __________ studies fossils and ancient life on Earth.",
      options:["paleontologist","favorite","ravine","layers"],
      answer:"paleontologist",
      hint:"This job studies dinosaurs and fossils, not stars or rocks only."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThey planned to __________ the area carefully to search for more bones.",
      options:["excavate","examine","dream","tripped"],
      answer:"excavate",
      hint:"This verb means to dig in a careful, scientific way—often at a site with history or fossils."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThe dinosaur’s __________ helps scientists understand what it might have eaten.",
      options:["skull","ash","pastime","ravine"],
      answer:"skull",
      hint:"This is the hard part of the head that protects the brain."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nA __________ is an animal that lived millions of years ago. Many kinds are extinct now.",
      options:["dinosaur","layers","ash","favorite"],
      answer:"dinosaur",
      hint:"It’s not just ‘a big animal.’ It refers to a group of animals from a very long time ago."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nVolcanic __________ can fall from the sky and later become part of the ground.",
      options:["ash","layers","skull","pastime"],
      answer:"ash",
      hint:"This is the fine gray powder left after something burns (or after a volcano erupts)."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThe bone was buried in __________ rock, formed by tiny pieces of material pressed together over time.",
      options:["sedimentary rock","ash","layers","ravine"],
      answer:"sedimentary rock",
      hint:"This kind of rock often forms in layers from sand, mud, or small bits of rock."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nThe ground had __________ under it, like pages in a book stacked on top of each other.",
      options:["layers","pastime","skull","tripped"],
      answer:"layers",
      hint:"Think: one thin level on top of another level."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nIn 2003, scientists __________ a major fossil site near the town.",
      options:["discover","examine","dream","determine"],
      answer:"discover",
      hint:"This means to find something for the first time (or to find something that was hidden)."
    },
    {
      type:"mcq",
      section:"Vocabulary in Context",
      prompt:"Choose the best word:\nJavier’s __________ activity was exploring outdoors, even when it was hot.",
      options:["favorite","ash","layers","ravine"],
      answer:"favorite",
      hint:"This adjective means the one you like the most."
    },

    // ============ SPELLING / UNSCRAMBLE (5) ============
    // Note: during these, we hide the right vocab list panel
    { type:"unscramble", section:"Spelling (Unscramble)", answer:"paleontologist", scramble:"tsoaglnplieo" },
    { type:"unscramble", section:"Spelling (Unscramble)", answer:"sedimentary rock", scramble:"tadmsrneiyo rcko" },
    { type:"unscramble", section:"Spelling (Unscramble)", answer:"excavate", scramble:"vtaeeacx" },
    { type:"unscramble", section:"Spelling (Unscramble)", answer:"determine", scramble:"eidtmrnee" },
    { type:"unscramble", section:"Spelling (Unscramble)", answer:"ravine", scramble:"vniera" },

    // ============ READING COMPREHENSION (2) ============
    {
      type:"mcq",
      section:"Reading Comprehension",
      prompt:
`Read the excerpt, then answer:

“‘This bone was buried in sedimentary rock, which lies in layers under the ground. We’ll look for volcanic ash below and above this rock layer. Through a special process, we can find out the ages of those layers of ash.’”

Question: Why does the scientist mention ash “below and above” the rock layer?`,
      options:[
        "To estimate the bone’s age by comparing the ages of the ash layers around it",
        "To prove the bone is made of ash and not rock",
        "To show that ash is always older than sedimentary rock",
        "To explain why the bone is easy to see on the surface"
      ],
      answer:"To estimate the bone’s age by comparing the ages of the ash layers around it",
      hint:"Think ‘timeline.’ If you know ages on both sides of something, you can narrow down when it happened."
    },
    {
      type:"mcq",
      section:"Reading Comprehension",
      prompt:
`Read the excerpt, then answer:

“Javier and the boys ran home to tell Javier’s parents. Javier’s father spoke to the mayor of the town, who contacted the Paleontology Foundation.”

Question: What is the best reason they contacted adults and the foundation instead of digging by themselves?`,
      options:[
        "Because professionals need to examine the find and dig carefully without damaging it",
        "Because children are not allowed to be curious about nature",
        "Because the foundation can make the dinosaur come back to life",
        "Because only adults can see objects buried in sedimentary rock"
      ],
      answer:"Because professionals need to examine the find and dig carefully without damaging it",
      hint:"The key idea is safety + protecting evidence. Fossils can break, and the site can be ruined if people dig incorrectly."
    }
  ];

  // ===== State
  let idx = 0;
  let score = 0;
  let mode = "Main"; // Main or Review
  let wrongQueue = [];     // stores indices of wrong questions (MCQ only)
  let reviewPtr = 0;
  let locked = false;      // lock after correct until next
  let hintUsedThisQ = false;

  // ===== Elements
  const sectionLabel = document.getElementById("sectionLabel");
  const qHeader = document.getElementById("qHeader");
  const promptBox = document.getElementById("promptBox");
  const optionsEl = document.getElementById("options");
  const feedbackEl = document.getElementById("feedback");
  const nextBtn = document.getElementById("nextBtn");
  const restartBtn = document.getElementById("restartBtn");
  const hintBtn = document.getElementById("hintBtn");
  const pillProgress = document.getElementById("pillProgress");
  const pillScore = document.getElementById("pillScore");
  const pillMode = document.getElementById("pillMode");
  const barFill = document.getElementById("barFill");
  const vocabPanel = document.getElementById("vocabPanel");

  const unscrambleArea = document.getElementById("unscrambleArea");
  const scrambleText = document.getElementById("scrambleText");
  const spellInput = document.getElementById("spellInput");
  const checkSpellBtn = document.getElementById("checkSpellBtn");

  function totalCount(){
    return questions.length;
  }

  function currentQuestionIndex(){
    if(mode === "Main") return idx;
    return wrongQueue[reviewPtr];
  }

  function setPills(){
    const total = totalCount();
    const shownNumber = (mode === "Main") ? (idx + 1) : (reviewPtr + 1);
    const shownTotal = (mode === "Main") ? total : wrongQueue.length;

    pillProgress.textContent = `${shownNumber}/${shownTotal}`;
    pillScore.textContent = `${score}`;
    pillMode.textContent = mode;

    const pct = (mode === "Main")
      ? ((idx) / total) * 100
      : ((reviewPtr) / Math.max(1, wrongQueue.length)) * 100;

    barFill.style.width = `${Math.min(100, Math.max(0, pct))}%`;
  }

  function clearFeedback(){
    feedbackEl.className = "feedback";
    feedbackEl.textContent = "Click an answer. If it’s wrong, read the hint and try again.";
  }

  function setFeedback(type, text){
    feedbackEl.className = "feedback " + (type || "");
    feedbackEl.textContent = text;
  }

  function render(){
    locked = false;
    hintUsedThisQ = false;
    nextBtn.disabled = true;
    optionsEl.innerHTML = "";
    spellInput.value = "";
    unscrambleArea.classList.add("hidden");
    vocabPanel.classList.remove("hidden");

    const q = questions[currentQuestionIndex()];
    sectionLabel.textContent = q.section;

    const displayNum = (mode === "Main") ? (idx + 1) : (reviewPtr + 1);
    const displayTotal = (mode === "Main") ? totalCount() : wrongQueue.length;
    qHeader.textContent = `Question ${displayNum} of ${displayTotal}`;

    promptBox.textContent = q.prompt || "";

    // Unscramble vs MCQ
    if(q.type === "unscramble"){
      // Hide vocab list during spelling tasks
      vocabPanel.classList.add("hidden");

      // Update prompt and show scramble area
      promptBox.textContent = "Unscramble the letters to spell the vocabulary word.\n(Use spaces if needed.)";
      unscrambleArea.classList.remove("hidden");
      scrambleText.textContent = q.scramble;

      // No MCQ options
      optionsEl.innerHTML = "";

      setFeedback("", "Type the word, then click Check. If it’s wrong, try again.");
    } else {
      // MCQ
      const opts = q.options;
      opts.forEach(opt=>{
        const b = document.createElement("button");
        b.className = "opt";
        b.textContent = opt;
        b.onclick = ()=> choose(opt);
        optionsEl.appendChild(b);
      });

      clearFeedback();
    }

    setPills();
  }

  function disableOptions(){
    const btns = optionsEl.querySelectorAll("button.opt");
    btns.forEach(b=> b.disabled = true);
  }

  function enableOptions(){
    const btns = optionsEl.querySelectorAll("button.opt");
    btns.forEach(b=> b.disabled = false);
  }

  function normalize(s){
    return (s || "")
      .trim()
      .replace(/\s+/g, " ")
      .toLowerCase();
  }

  function choose(selected){
    if(locked) return;

    const q = questions[currentQuestionIndex()];
    if(q.type !== "mcq") return;

    if(selected === q.answer){
      locked = true;
      disableOptions();

      // Score only counts in Main mode, and only once per question
      if(mode === "Main"){
        score += 1;
      }

      setFeedback("good", "Correct. Click Next when you are ready.");
      nextBtn.disabled = false;
      setPills();
    } else {
      // wrong attempt
      // push into review queue (Main mode only; MCQ only)
      const qi = currentQuestionIndex();
      if(mode === "Main" && !wrongQueue.includes(qi)){
        wrongQueue.push(qi);
      }

      // give hint, not the answer
      setFeedback("warn", q.hint || "Try again. Look at the sentence and think about meaning.");
      hintUsedThisQ = true;
    }
  }

  function showHint(){
    const q = questions[currentQuestionIndex()];
    if(q.type === "unscramble"){
      setFeedback("warn", "Hint: Say the word slowly. Check spelling pattern and syllables.");
      return;
    }
    setFeedback("warn", q.hint || "Try again. Use the context clues.");
  }

  function next(){
    // If unscramble: must be correct before next
    const q = questions[currentQuestionIndex()];
    if(q.type === "unscramble"){
      // next is enabled only after correct check
      if(nextBtn.disabled) return;
    } else {
      // MCQ requires correct lock
      if(!locked) return;
    }

    if(mode === "Main"){
      idx++;
      if(idx < totalCount()){
        render();
      } else {
        startReviewOrFinish();
      }
    } else {
      reviewPtr++;
      if(reviewPtr < wrongQueue.length){
        render();
      } else {
        finish();
      }
    }
  }

  function startReviewOrFinish(){
    // Review only MCQ errors; unscramble doesn’t enter review
    if(wrongQueue.length > 0){
      mode = "Review";
      reviewPtr = 0;
      pillMode.textContent = mode;
      setFeedback("warn", "Review Mode: You will retry questions you missed. Get them correct this time.");
      render();
    } else {
      finish();
    }
  }

  function finish(){
    // Summary screen
    optionsEl.innerHTML = "";
    unscrambleArea.classList.add("hidden");
    vocabPanel.classList.remove("hidden");
    sectionLabel.textContent = "Finished";
    qHeader.textContent = "All done";
    promptBox.textContent = "You have finished the practice.";

    const total = totalCount();
    const mcqCount = questions.filter(q=>q.type==="mcq").length;
    // score reflects only MCQ correct in Main mode (that’s intentional for this style)
    const wrongWords = wrongQueue
      .map(i => {
        const w = questions[i].answer; // answer is a word/phrase
        return w;
      })
      .filter((v, pos, arr)=> arr.indexOf(v) === pos);

    let msg = `Your score (Main mode, MCQ only): ${score} / ${mcqCount}.`;
    if(wrongWords.length){
      msg += `\n\nWords to review:\n- ` + wrongWords.join("\n- ");
    } else {
      msg += `\n\nGreat work. No vocabulary words to review from the MCQ section.`;
    }

    setFeedback("good", msg);
    nextBtn.disabled = true;

    // Set bar to full
    barFill.style.width = "100%";
    pillProgress.textContent = `${total}/${total}`;
    pillMode.textContent = "Done";
    pillScore.textContent = `${score}`;
  }

  function restart(){
    idx = 0;
    score = 0;
    mode = "Main";
    wrongQueue = [];
    reviewPtr = 0;
    locked = false;
    hintUsedThisQ = false;
    nextBtn.disabled = true;
    render();
  }

  // Unscramble check
  function checkSpelling(){
    const q = questions[currentQuestionIndex()];
    if(q.type !== "unscramble") return;

    const typed = normalize(spellInput.value);
    const ans = normalize(q.answer);

    if(typed === ans){
      setFeedback("good", "Correct spelling. Click Next when you are ready.");
      nextBtn.disabled = false;
      // (Optional) You could also score spelling; you asked mainly vocab focus, so we keep score simple.
    } else {
      setFeedback("warn", "Not quite. Check the letter order and any spaces. Try again.");
      nextBtn.disabled = true;
    }
  }

  // Events
  nextBtn.addEventListener("click", next);
  restartBtn.addEventListener("click", restart);
  hintBtn.addEventListener("click", showHint);
  checkSpellBtn.addEventListener("click", checkSpelling);
  spellInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      e.preventDefault();
      checkSpelling();
    }
  });

  // Start
  render();
</script>
</body>
</html>
